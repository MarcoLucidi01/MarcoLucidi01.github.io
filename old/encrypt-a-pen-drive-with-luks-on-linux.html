<!DOCTYPE html>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta charset="utf-8">
<link rel="stylesheet" href="../style.css">
<title>encrypt a pen drive with LUKS on Linux</title>

<h1>encrypt a pen drive with LUKS on Linux</h1>

<h2>info</h2>
<ul>
<li><a href="https://gitlab.com/cryptsetup/cryptsetup/blob/master/README.md">cryptsetup</a> (official site) <a href="https://linux.die.net/man/8/cryptsetup">man</a> (man page)
<li><a href="https://en.wikipedia.org/wiki/Linux_Unified_Key_Setup">LUKS</a> (wikipedia)
<li><a href="https://wiki.archlinux.org/index.php/Dm-crypt/Device_encryption">Dm-crypt/Device_encryption</a> (Arch Wiki)
</ul>

<h2>set up the drive</h2>
<p>First of all, we need to install "cryptsetup" on our system.

<p>I'm on Debian so:
<pre>
# apt-get install cryptsetup
</pre>

<p>after connecting the drive, we need to get the device name assigned to it:
<pre>
# fdisk -l
</pre>

<img src="../imgs/fdisk-l.png" title="LOL, yes, I have a 125 MiB pen drive">
<p>as you can see, in my case is "/dev/sdb".

<p>Now, this step, will destroy all data on the drive. Make sure you have a
backup before proceeding.

<p>"Umount" your drive and then type:
<pre>
# cryptsetup -y -v luksFormat your_device
</pre>
<ul class="no-bullet">
<li>-y: query for passwords twice.
<li>-v: verbose.
</ul>
<p>and follow the instruction on screen.</p>

<img src="../imgs/cryptsetup-luksFormat.png" title="/dev/sdb is my device of course">

<p>Of course, several other options can be added, I'm ok with the defaults, but
if you want, in the info links, you will find suggestions to add other options.

<p>OK, the device is encrypted. What's missing? A file system!

<pre>
# cryptsetup luksOpen your_device name_you_want
</pre>
<p>to unlock the drive. You will be asked for the password of course.

<pre>
# mkfs -t ext4 /dev/mapper/name_you_used_before
</pre>
<p>and you will get a result similar to this:</p>
<img src="../imgs/mkfs-t-ext4.png" title="In name_you_want I used pen">

<p>Now we can actually mount the drive. Here a picture, I'll explain in the next section.</p>
<img src="../imgs/mount-luks.png" title="Like a normal drive">

<h2>mount an encrypted drive</h2>
<p>Many Desktop Environments (at least KDE) are capable to recognize a LUKS
drive when it is connected and do the dirty work for you.</p>

<img src="../imgs/kde-mount-luks.png" title="Fancy KDE's way">

<p>But, since I'm a fan of command line (mainly because is a "universal"
interface among the distributions), I'm going to show that way.

<p>Zero step: connect the drive and check the device name
<p>First step: unlock the drive
<pre>
# cryptsetup luksOpen your_device name_you_want
</pre>
<p>Second step: mount the drive on a mount point
<pre>
# mount /dev/mapper/name_you_used_before mount_point_you_like
</pre>
<p>(with file systems different from "ext" could be required specify the type)
<p>Done.</p>

<img src="../imgs/luks-summary.png">

<h2>umount an encrypted drive</h2>
<p>The things here are easy:
<pre>
# umount mount_point_used_before
# cryptsetup luksClose name_used_before
</pre>
<p>Done.

<h2>conclusion</h2>
<p>This isn't a professional tutorial, no argument has been deepened, it's just
a quick way to set up an encrypted pen drive (or external Hard Disk, SD card, etc...)
with a password that works well on Linux.
<p>I encourage you to explore these topics starting from the links provided at
the beginning of the post, to get a better understanding of what we have done
today. Bye.

<footer><a href="../index.html">index</a></footer>
